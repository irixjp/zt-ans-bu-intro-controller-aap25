= ラボガイド: Survey 付き Job Template の作成
:notoc:
:toc-title: Table of Contents
:nosectnums:
:icons: font

_Apache をインストールする 4 つ目の Job Template を作成し、実行時に変数を渡す Survey を含めるためのガイド。_

---

== ラボ概要

automation controller では、**job templates** は `ansible-playbook` コマンドと、CLI 実行時に使える各種フラグを視覚化したものです。Ansible Playbook を実行する主要な仕組みです。

image::job-templates-home-with-example-job-template.png[Job Templates list view in automation controller, opts="border"]

---

== ラボガイド: ハンズオンタスク

このチャレンジでは **Survey** 機能を確認します。Survey を使うと Job Template 起動時にユーザー入力を受け付けられるため、実行ごとにパラメーターや設定を変更できます。Apache playbook がデプロイする `index.html` を Survey でカスタマイズします。

[IMPORTANT]
====
automation controller へのログイン認証情報:

* *Username:* `admin`
* *Password:* `ansible123!`
====

=== Task 1: Job Template を作成する

最初に、survey 変数で動作する playbook を使う新しい job template を作成します。

. **Templates ページへ移動する。**
+
左側ナビゲーションメニューで **Automation Execution** → **Templates** に移動します。

. **新しい job template を作成する。**
+
青色の **Create template** ボタンを **クリック** し、**Create job template** を選択します。

. **job template の詳細を入力する。**
+
フォームに以下を入力します。
+
* **Name:** `Install Apache with Survey`
* **Job Type:** `Run`
* **Inventory:** `Lab-Inventory`
* **Project:** `Apache playbooks`
* **Playbook:** `apache_template.yml`
* **Credentials:** `lab-credentials` を選択
* **Privilege Escalation:** `become` を有効にするため **チェック**

. **job template を保存する。**
+
他の項目はそのままにして、青色の **Create job template** ボタンを **クリック** します。

=== Task 2: Survey を作成する

次に、job template に survey を追加してユーザー名を尋ねます。

. **Survey タブへ移動する。**
+
Job Template を保存すると *Details* ページに移動します。**Survey** タブを **クリック** します。

. **新しい survey 質問を作成する。**
+
青色の **Create survey question** ボタンを **クリック** します。

. **survey 質問を設定する。**
+
フォームに以下を入力します。
+
--
* **Question:** `What is your name, fellow student?`
* **Description:** `Enter your name or nickname to see it work!`
* **Answer variable name:** `student_name`
* **Answer type:** `Text`（デフォルト）
* **Required:** **チェックしない**
* **Default answer:** `Skippy`
--

. **survey 質問を保存する。**
+
下部の青色 **Create survey question** ボタンを **クリック** します。

. **survey を有効化する。**
+
Survey タブで **Survey disabled** と表示されるトグルが出ます。このトグルを **クリック** して survey を **有効化** します。

=== Task 3: Template を起動して Survey を使う

最後に template を起動し、survey でカスタム値を入力します。

. **template を起動する。**
+
`Install Apache with Survey` job template 画面上部の **Launch template** ボタンを **クリック** します。

. **survey 質問に回答する。**
+
survey 入力画面が表示されます。デフォルト回答（`Skippy`）を **削除** し、**自分の名前** を入力します。

. **ジョブを起動する。**
+
**Next** ボタンを **クリック** し、内容確認後に **Finish** ボタンを **クリック** してジョブを起動します。

. **結果を確認する。**
+
ジョブが成功したら、ラボ画面上部の **Node1 Web** タブに **移動** します。必要に応じてページをリロードしてください。Apache メッセージの下に入力した名前が表示されます。
+
image:May-13-2025_at_21.04.19-image.png[Customized Apache welcome page, opts="border"]

---

== おめでとうございます！

ラボは正常に完了しました！ 🎉

[IMPORTANT]
====
ラボを完了するため、下の緑色の **Check**、**Next**、または **Skip** ボタンを押してください。フィードバックも歓迎します。
====

=== バッジを受け取る

次の QR コードをスキャンして、このラボ完了の Ansible Forum バッジを受け取ってください。

image::May-13-2025_at_21.28.27-image.png[QR code for Ansible Forum badge, opts="border"]

まだ Ansible Forum アカウントがない場合でも問題ありません。同じリンクから登録できます。Google または GitHub アカウントでログインすれば、自動的にアカウントが作成されます。

登録後は、link:https://forum.ansible.com/t/introduce-yourself-2025-edition/39892[this Forum topic] で自己紹介するのを忘れないでください。

---

== トラブルシューティング

問題が発生した場合や不具合を見つけた場合は、link:https://github.com/ansible/workshops/issues/new?labels=controller-101&title=Issue+with+Intro+to+Controller+slug+ID:+controller-101-inventory+AAP25&assignees=leogallego[GitHub で issue を作成してください]。
