= ラボガイド: Job Template の作成
:notoc:
:toc-title: Table of Contents
:nosectnums:
:icons: font

_Job Template を作成して起動し、automation controller で playbook を実行するためのガイド。_

---

== ラボ概要

automation controller では、**job templates** は `ansible-playbook` コマンドと、CLI 実行時に使える各種フラグを視覚化したものです。Ansible Playbook を実行する主要な仕組みです。

image::job-templates-home-with-example-job-template.png[Job Templates list view in automation controller, opts="border"]

---

== ラボガイド: ハンズオンタスク

**Job Template** は、Ansible Playbook 実行の定義とパラメーターのセットです。同じジョブを何度も実行する用途に有効で、Ansible コンテンツの再利用やチーム間のコラボレーションを促進します。

Job Template を作成するには、前のチャレンジで作成した **Project** が必要です。Project には複数 playbook を含められますが、Job Template で一度に実行できる playbook は 1 つだけです。

[WARNING]
====
**Job Template** と **Jinja template** を混同しないでください。Jinja templates は、実行時に変数を置き換えて動的コンテンツ（設定ファイルなど）を生成するためのファイルで、別の概念です。
====

[IMPORTANT]
====
automation controller へのログイン認証情報:

* *Username:* `admin`
* *Password:* `ansible123!`
====

=== Task 1: Job Template を作成する

最初に、inventory、project、playbook、credentials を関連付ける新しい job template を作成します。

. **Templates ページへ移動する。**
+
左側ナビゲーションメニューで **Automation Execution** → **Templates** に移動します。

. **新しい job template を作成する。**
+
青色の **Create template** ボタンを **クリック** し、**Create job template** を選択します。

. **job template の詳細を入力する。**
+
フォームに以下を入力します。
+
* **Name:** `Install Apache`
* **Job Type:** `Run`
* **Inventory:** `Lab-Inventory`
* **Project:** `Apache playbooks`
* **Playbook:** `apache.yml`
* **Credentials:** `lab-credentials` を選択
* **Privilege Escalation:** `become` を有効にするため **チェック**

. **job template を保存する。**
+
他の項目はそのままにして、青色の **Create job template** ボタンを **クリック** します。

[IMPORTANT]
====
*Credentials* フィールドはすべての job templates で必須ではありませんが、リモートホストへ接続するジョブで正しい machine credentials を選択しないと実行に失敗します。
====

=== Task 2: Job Template を起動する

job template を作成できたので、実際に起動して playbook を実行します。

. **Templates ページへ移動する。**
+
まだ表示していない場合は、**Automation Execution** → **Templates** に移動します。

. **template を起動する。**
+
起動方法は 2 通りあります。
+
--
* 一覧の `Install Apache` テンプレート横にある **Launch** アイコン（🚀）を **クリック**
* `Install Apache` の名前を **クリック** して詳細ページを開き、青色の **Launch** ボタンを **クリック**
--

. **実行を確認する。**
+
ジョブが実行され、出力ページに移動します。ジョブが **Successful** ステータスで完了することを **確認** します。

=== Task 3: 結果を確認する

最後に、Apache Web サーバーが両ノードに正しくインストールされたことを確認します。

. **Node1 の Web ページを確認する。**
+
ラボ画面上部のタブバーで **Node1 Web** タブを **クリック** し、"Hello World" メッセージが表示されることを確認します。

. **Node2 の Web ページを確認する。**
+
**Node2 Web** タブを **クリック** し、同じ "Hello World" メッセージが表示されることを確認します。

---

== 次のステップ

次のチャレンジに進むには、下の `Check` ボタンを押してください。

== トラブルシューティング

問題が発生した場合や不具合を見つけた場合は、link:https://github.com/ansible/workshops/issues/new?labels=controller-101&title=Issue+with+Intro+to+Controller+slug+ID:+controller-101-inventory+AAP25&assignees=leogallego[GitHub で issue を作成してください]。
